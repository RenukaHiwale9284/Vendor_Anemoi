<h1 style="color: #415385; font-size: 25px">Templates</h1>
<p-card *ngIf="loadView" styleClass="container1 scrollable">
  <ng-template pTemplate="header">
    <div class="left-aligned">
      <p for="Back button" class="header-back-button" (click)="onClickBack()">
        <i class="pi pi-chevron-left"></i>
        {{ selectedTemplateData.templateDescription.name }}
      </p>
    </div>
    <div class="right-aligned">
      <button
        pButton
        label="Download template"
        icon="pi pi-download"
        class="p-button-sm pbuttonclass standard-button"
        (click)="onClickTemplateDownload()"
      ></button>

      <!-- <button
        pButton
        label="Share Template"
        icon="pi pi-send"
        class="p-button-sm pbuttonclass standard-button"
        style="margin-right: 20px"
        (click)="openShareOverlay1($event)"
      ></button> -->
      <!-- style="zoom:70%" -->
      <p-overlayPanel #shareOverlay [style]="{ width: '500px' }">
        <ng-template pTemplate>
          <div class="comment-overlay-panel">
            <p-tabView>
              <p-tabPanel header="Client">
                <ul *ngFor="let i of roleNames; let j = index">
                  <li style="list-style-type: none">
                    <p-checkbox
                      name="groupname"
                      [value]="i.email"
                      [(ngModel)]="selectedValue"
                      (click)="onChecks()"
                    ></p-checkbox>
                    &nbsp;{{ i.email }}
                  </li>
                </ul>
              </p-tabPanel>

              <p-tabPanel header="Team">
                <ul *ngFor="let i of projectNames; let l = index">
                  <li style="list-style-type: none">
                    <p-checkbox
                      name="groupname"
                      [value]="i.businessUser"
                      [(ngModel)]="selectedValue"
                      (click)="onChecks()"
                    ></p-checkbox>
                    &nbsp;{{ i.businessUser }}
                  </li>
                </ul>
              </p-tabPanel>
              <div class="footer">
                <button
                  class="p-button-outlined cancleButton"
                  style="float: left"
                  pButton
                  label="Cancel"
                ></button>

                <button
                  class="submitButton"
                  style="float: right"
                  pButton
                  icon="pi pi-send"
                  label="Send"
                ></button>
              </div>
            </p-tabView>
          </div>
        </ng-template>
      </p-overlayPanel>
    </div>
    <div class="clearfix"></div>
  </ng-template>
  <span *ngIf="duplicateErrormsg"
    ><h3 style="color: red">There might be duplicate fields found</h3></span
  >

  <form [formGroup]="templateForm">
    <div formArrayName="category" class="container-with-scrollbar">
      <table style="width: 100%">
        <thead>
          <tr>
            <table>
              <tr>
                <th class="header">Category</th>
                <th class="weightage">Weightage</th>
                <table style="width: 100%">
                  <tr>
                    <th class="header">Primary sub-category</th>
                    <th class="weightage">Weightage</th>

                    <table style="width: 100%">
                      <tr>
                        <th class="header">Secondary sub-category</th>
                        <th class="weightage">Weightage</th>
                        <table style="width: 100%">
                          <tr>
                            <th class="header">Tertiary sub-category</th>
                            <th class="weightage">Weightage</th>
                            <table style="width: 100%">
                              <tr>
                                <th class="header">Parameter</th>
                                <th class="weightage">Weightage</th>
                                <th class="weightage">Max score</th>
                                <th
                                  *ngIf="!scoringCriteriaColumn"
                                  class="header"
                                >
                                  Scoring criteria
                                </th>
                              </tr>
                            </table>
                          </tr>
                        </table>
                      </tr>
                    </table>
                  </tr>
                </table>
              </tr>
            </table>
          </tr>
        </thead>
        <tbody class="table1">
          <!-- <p-accordion>
            <p-accordionTab header="Header 1"> -->
          <table>
            <tr
              *ngFor="
                let category of getCategoryControls().controls;
                let i = index
              "
            >
              <!-- <button class="pbuttonclass" (click)="toggleRow(i)"><i class="pi pi-plus-circle"></i></button> -->
              <!-- <div  [formGroupName]="i" class="display" *ngIf="!isCollapsed"> -->
              <p-accordion>
                <p-accordionTab
                  headerStyleClass="headerclass"
                  [selected]="true"
                >
                  <ng-template pTemplate="header">
                    <div class="header1">
                    &nbsp;  {{ category.value.name }} ({{
                        category.value.weightage
                      }}%)
                    </div>
                  </ng-template>
                  <div
                    style="overflow-x: auto; overflow-x: hidden; height: 20rem"
                  >
                    <table style="margin-top: 20px">
                      <tr>
                        <div
                          [formGroupName]="i"
                          class="display"
                          style="overflow: scroll"
                        >
                          <td style="width: 50%">
                            <div style="position: relative">
                              <p-badge
                                *ngIf="category.value.badgeCount > 0"
                                [value]="category.value.badgeCount"
                                class="comment-badge"
                                (click)="
                                  openViewCommentOverlay(
                                    $event,
                                    category.value.nodeId
                                  )
                                "
                                severity="warning"
                              ></p-badge>
                              <p-cascadeSelect
                                id="username"
                                styleClass="cascadeSelect"
                                formControlName="name"
                                [showClear]="true"
                                (onClear)="onClearInput()"
                                (onChange)="
                                  [
                                    onDropdownChange($event),
                                    onValidateCategory($event, 'category', i)
                                  ]
                                "
                                [options]="categoriesData"
                                optionLabel="name"
                                optionValue="name"
                                optionGroupLabel="name"
                                [optionGroupChildren]="['states', 'cities']"
                                [style]="{ width: '13.7rem' }"
                                placeholder="Select"
                                appendTo="body"
                              >
                              </p-cascadeSelect>
                              <p>
                                <mat-error
                                  *ngIf="(
                                    getCategoryControls()?.at(i)?.dirty ||
                                    getCategoryControls()?.at(i)?.touched
                                 ) &&
                                 getCategoryControls()?.at(i)?.errors?.['categoryError']"
                                >
                                  Duplicate category name is not allowed
                                </mat-error>
                              </p>
                              <div *ngIf="access.optionButton.view">
                                <button
                                  class="bottun-align"
                                  mat-icon-button
                                  [matMenuTriggerFor]="cat"
                                  aria-label="Example icon-button with a menu"
                                >
                                <i class="pi pi-ellipsis-v"></i> &nbsp;
                                </button>
                                <!-- <button type="button" (click)="addCategory()">Add Category</button>
                                        <button type="button" (click)="removeCategory(i)">Remove Category</button> -->
                                <mat-menu #cat="matMenu">
                                  <button
                                    mat-menu-item
                                    (click)="onSearchOption('category', i)"
                                  >
                                  <i class="pi pi-search"></i> &nbsp;
                                    <span>Search Category</span>
                                  </button>
                                  <button
                                    mat-menu-item
                                    (click)="onAddCustom('category')"
                                  >
                                  <i class="pi pi-pencil"></i> &nbsp;
                                    <span>Add Custom Category</span>
                                  </button>
                                  <button
                                    mat-menu-item
                                    (click)="addSingleCategory()"
                                  >
                                  <i class="pi pi-plus-circle"></i> &nbsp;
                                    <span>Add New Category</span>
                                  </button>
                                  <button
                                    mat-menu-item
                                    (click)="initCombine(i, 'category')"
                                  >
                                  <i class="pi pi-sync"></i> &nbsp;
                                    <span>Combine with</span>
                                  </button>
                                </mat-menu>
                              </div>
                            </div>
                          </td>

                          <td style="width: 50%">
                            <div>
                              <input
                                pInputText
                                type="number"
                                class="form-control"
                                formControlName="weightage"
                                min="0"
                                (keyup)="validateWeightage(i, 'category')"
                              />
                              <p>
                                <mat-error
                                  *ngIf="(
                      getCategoryControls()?.at(i)?.dirty ||
                      getCategoryControls()?.at(i)?.touched
                   ) &&
                   getCategoryControls()?.at(i)?.errors?.['weightageError']"
                                >
                                  Weightage Addition should not be greater than
                                  100
                                </mat-error>
                              </p>
                              <p>
                                <mat-error
                                  *ngIf="(
                      getCategoryControls()?.at(i)?.dirty ||
                      getCategoryControls()?.at(i)?.touched
                   ) &&
                   getCategoryControls()?.at(i)?.errors?.['negativeWeightageError']"
                                >
                                  Only Positive decimal numbers are allowed
                                </mat-error>
                              </p>
                            </div>
                          </td>
                          <!-- subcategory Start-->
                          <div formArrayName="subcategory">
                            <table style="width: 100%">
                              <tr
                                *ngFor="
                                  let subCategory of getSubCategoryControls(i)
                                    .controls;
                                  let j = index
                                "
                              >
                                <div [formGroupName]="j" class="display">
                                  <td style="width: 50%">
                                    <div style="position: relative">
                                      <p-badge
                                        *ngIf="subCategory.value.badgeCount > 0"
                                        [value]="subCategory.value.badgeCount"
                                        class="comment-badge"
                                        (click)="
                                          openViewCommentOverlay(
                                            $event,
                                            subCategory.value.nodeId
                                          )
                                        "
                                        severity="warning"
                                      ></p-badge>
                                      <p-cascadeSelect
                                        id="subcategoryname"
                                        formControlName="subcategoryname"
                                        [options]="categoriesData"
                                        optionLabel="name"
                                        optionValue="name"
                                        optionGroupLabel="name"
                                        [optionGroupChildren]="[
                                          'states',
                                          'cities'
                                        ]"
                                        [style]="{ width: '13.7rem' }"
                                        placeholder="Select"
                                        appendTo="body"
                                        [showClear]="true"
                                        (onChange)="
                                          onValidateCategory(
                                            $event,
                                            'subcategory',
                                            i,
                                            j
                                          )
                                        "
                                      >
                                      </p-cascadeSelect>
                                      <p>
                                        <mat-error
                                          *ngIf="(
                          getSubCategoryControls(i)?.at(j)?.dirty ||
                          getSubCategoryControls(i)?.at(j)?.touched
                       ) &&
                       getSubCategoryControls(i)?.at(j)?.errors?.['subCategoryError']"
                                        >
                                          Duplicate subcategory name
                                          selected</mat-error
                                        >
                                      </p>
                                      <div *ngIf="access.optionButton.view">
                                        <button
                                          class="bottun-align"
                                          mat-icon-button
                                          [matMenuTriggerFor]="sub"
                                          aria-label="Example icon-button with a menu"
                                        >
                                        <i class="pi pi-ellipsis-v"></i> &nbsp;
                                        </button>
                                        <mat-menu #sub="matMenu">
                                          <button
                                            mat-menu-item
                                            (click)="
                                              onSearchOption(
                                                'subCategory',
                                                i,
                                                j
                                              )
                                            "
                                          >
                                          <i class="pi pi-search"></i> &nbsp;
                                            <span>Search Sub-Category</span>
                                          </button>
                                          <button
                                            mat-menu-item
                                            (click)="onAddCustom('Subcategory')"
                                          >
                                          <i class="pi pi-pencil"></i> &nbsp;
                                            <span>Add Custom Sub-Category</span>
                                          </button>
                                          <button
                                            mat-menu-item
                                            (click)="addSubCategory(i)"
                                          >
                                          <i class="pi pi-plus-circle"></i> &nbsp;
                                            <span>Add New Sub-Category</span>
                                          </button>
                                          <button
                                            mat-menu-item
                                            (click)="
                                              initCombine(i, 'subCategory', j)
                                            "
                                          >
                                          <i class="pi pi-plus-circle"></i> &nbsp;
                                            <span>Combine with</span>
                                          </button>
                                          <button
                                            [disabled]="
                                              getSubCategoryControls(i)
                                                .length == 1
                                                ? true
                                                : false
                                            "
                                            mat-menu-item
                                            (click)="removeSubCategory(i, j)"
                                          >
                                          <i class="pi pi-minus-circle"></i> &nbsp;
                                            <span>Remove Sub-Category</span>
                                          </button>
                                        </mat-menu>
                                      </div>
                                    </div>
                                  </td>
                                  <td style="width: 50%">
                                    <div>
                                      <input
                                        pInputText
                                        type="number"
                                        class="form-control"
                                        formControlName="weightage"
                                        min="0"
                                        step="0.0001"
                                        pattern="^[0-9]+(\.[0-9]{1,4})?$"
                                        (keyup)="
                                          validateWeightage(i, 'subCategory')
                                        "
                                      />
                                      <p>
                                        <mat-error
                                          *ngIf="(
                            getSubCategoryControls(i)?.at(j)?.dirty ||
                            getSubCategoryControls(i)?.at(j)?.touched
                           ) &&
                           getSubCategoryControls(i)?.at(j)?.errors?.['weightageError']"
                                        >
                                          Weightage Addition should not be
                                          greater than 100
                                        </mat-error>
                                      </p>
                                      <p>
                                        <mat-error
                                          *ngIf="(
                            getSubCategoryControls(i)?.at(j)?.dirty ||
                            getSubCategoryControls(i)?.at(j)?.touched
                           ) &&
                           getSubCategoryControls(i)?.at(j)?.errors?.['negativeWeightageError']"
                                        >
                                          Only Positive decimal numbers are
                                          allowed
                                        </mat-error>
                                      </p>
                                    </div>
                                  </td>
                                  <!-- subcategoryTwo Start -->
                                  <div formArrayName="subcategoryTwo">
                                    <table style="width: 100%">
                                      <tr
                                        *ngFor="
                                          let subCategoryTwo of getSubCategoryTwoControls(
                                            i,
                                            j
                                          ).controls;
                                          let k = index
                                        "
                                      >
                                        <div
                                          [formGroupName]="k"
                                          class="display"
                                        >
                                          <td>
                                            <div style="position: relative">
                                              <p-badge
                                                *ngIf="
                                                  subCategoryTwo.value
                                                    .badgeCount > 0
                                                "
                                                [value]="
                                                  subCategoryTwo.value
                                                    .badgeCount
                                                "
                                                class="comment-badge"
                                                (click)="
                                                  openViewCommentOverlay(
                                                    $event,
                                                    subCategoryTwo.value.nodeId
                                                  )
                                                "
                                                severity="warning"
                                              ></p-badge>
                                              <p-cascadeSelect
                                                id="subcategoryname"
                                                formControlName="subcategoryname"
                                                [options]="categoriesData"
                                                optionLabel="name"
                                                optionValue="name"
                                                optionGroupLabel="name"
                                                [optionGroupChildren]="[
                                                  'states',
                                                  'cities'
                                                ]"
                                                [style]="{ width: '13.7rem' }"
                                                placeholder="Select"
                                                appendTo="body"
                                                [showClear]="true"
                                                (onChange)="
                                                  onValidateCategory(
                                                    $event,
                                                    'subcategoryTwo',
                                                    i,
                                                    j,
                                                    k
                                                  )
                                                "
                                              >
                                              </p-cascadeSelect>
                                              <p>
                                                <mat-error
                                                  *ngIf="(
                                    getSubCategoryTwoControls(i,j)?.at(k)?.dirty ||
                                    getSubCategoryTwoControls(i,j)?.at(k)?.touched
                                   ) &&
                                   getSubCategoryTwoControls(i,j)?.at(k)?.errors?.['subcategoryTwoError']"
                                                >
                                                  Duplicate subcategoryTwo name
                                                  selected
                                                </mat-error>
                                              </p>
                                              <div
                                                *ngIf="access.optionButton.view"
                                              >
                                                <button
                                                  class="bottun-align"
                                                  mat-icon-button
                                                  [matMenuTriggerFor]="
                                                    subCatTwo
                                                  "
                                                  aria-label="Example icon-button with a menu"
                                                >
                                                <i class="pi pi-ellipsis-v"></i> &nbsp;
                                                </button>
                                                <mat-menu #subCatTwo="matMenu">
                                                  <button
                                                    mat-menu-item
                                                    (click)="
                                                      onSearchOption(
                                                        'subCategoryTwo',
                                                        i,
                                                        j,
                                                        k
                                                      )
                                                    "
                                                  >
                                                  <i class="pi pi-search"></i> &nbsp;
                                                    <span
                                                      >Search Secondary
                                                      Sub-Category</span
                                                    >
                                                  </button>
                                                  <button
                                                    mat-menu-item
                                                    (click)="onAddCustom('Subcategory')"
                                                  >
                                                  <i class="pi pi-pencil"></i> &nbsp;
                                                    <span
                                                      >Add Custom Secondary
                                                      Sub-Category</span
                                                    >
                                                  </button>
                                                  <button
                                                    mat-menu-item
                                                    (click)="
                                                      addSubCategoryTwo(i, j)
                                                    "
                                                  >
                                                  <i class="pi pi-plus-circle"></i> &nbsp;
                                                    <span
                                                      >Add New Secondary
                                                      Sub-Category</span
                                                    >
                                                  </button>
                                                  <button
                                                    mat-menu-item
                                                    (click)="
                                                      initCombine(
                                                        i,
                                                        'subCategoryTwo',
                                                        j,
                                                        k
                                                      )
                                                    "
                                                  >
                                                  <i class="pi pi-sync"></i> &nbsp;
                                                    <span>Combine with</span>
                                                  </button>
                                                  <button
                                                    [disabled]="
                                                      getSubCategoryTwoControls(
                                                        i,
                                                        j
                                                      ).length == 1
                                                        ? true
                                                        : false
                                                    "
                                                    mat-menu-item
                                                    (click)="
                                                      removeSubCategoryTwo(
                                                        i,
                                                        j,
                                                        k
                                                      )
                                                    "
                                                  >
                                                  <i class="pi pi-minus-circle"></i> &nbsp;
                                                    <span
                                                      >Remove Secondary
                                                      Sub-Category</span
                                                    >
                                                  </button>
                                                </mat-menu>
                                              </div>
                                            </div>
                                          </td>
                                          <td>
                                            <div>
                                              <input
                                                pInputText
                                                type="number"
                                                class="form-control"
                                                formControlName="weightage"
                                                min="0"
                                                step="0.0001"
                                                pattern="^[0-9]+(\.[0-9]{1,4})?$"
                                                (keyup)="
                                                  validateWeightage(
                                                    i,
                                                    'subCategoryTwo',
                                                    j
                                                  )
                                                "
                                              />
                                              <p>
                                                <mat-error
                                                  *ngIf="(
                                    getSubCategoryTwoControls(i,j)?.at(k)?.dirty ||
                                    getSubCategoryTwoControls(i,j)?.at(k)?.touched
                                   ) &&
                                   getSubCategoryTwoControls(i,j)?.at(k)?.errors?.['weightageError']"
                                                >
                                                  Weightage Addition should not
                                                  be greater than 100
                                                </mat-error>
                                              </p>
                                              <p>
                                                <mat-error
                                                  *ngIf="(
                                    getSubCategoryTwoControls(i,j)?.at(k)?.dirty ||
                                    getSubCategoryTwoControls(i,j)?.at(k)?.touched
                                   ) &&
                                   getSubCategoryTwoControls(i,j)?.at(k)?.errors?.['negativeWeightageError']"
                                                >
                                                  Only Positive decimal numbers
                                                  are allowed
                                                </mat-error>
                                              </p>
                                            </div>
                                          </td>
                                          <!-- Start subcategoryThree -->
                                          <div formArrayName="subcategoryThree">
                                            <table style="width: 100%">
                                              <tr
                                                *ngFor="
                                                  let subCategoryThree of getSubCategoryThreeControls(
                                                    i,
                                                    j,
                                                    k
                                                  ).controls;
                                                  let l = index
                                                "
                                              >
                                                <div
                                                  [formGroupName]="l"
                                                  class="display"
                                                >
                                                  <td>
                                                    <div
                                                      style="position: relative"
                                                    >
                                                      <p-badge
                                                        *ngIf="
                                                          subCategoryThree.value
                                                            .badgeCount > 0
                                                        "
                                                        [value]="
                                                          subCategoryThree.value
                                                            .badgeCount
                                                        "
                                                        class="comment-badge"
                                                        (click)="
                                                          openViewCommentOverlay(
                                                            $event,
                                                            subCategoryThree
                                                              .value.nodeId
                                                          )
                                                        "
                                                        severity="warning"
                                                      ></p-badge>
                                                      <p-cascadeSelect
                                                        id="subcategoryname"
                                                        formControlName="subcategoryname"
                                                        [options]="
                                                          categoriesData
                                                        "
                                                        optionLabel="name"
                                                        optionValue="name"
                                                        optionGroupLabel="name"
                                                        [optionGroupChildren]="[
                                                          'states',
                                                          'cities'
                                                        ]"
                                                        [style]="{
                                                          width: '13.7rem'
                                                        }"
                                                        placeholder="Select"
                                                        appendTo="body"
                                                        [showClear]="true"
                                                        (onChange)="
                                                          onValidateCategory(
                                                            $event,
                                                            'subcategoryThree',
                                                            i,
                                                            j,
                                                            k,
                                                            l
                                                          )
                                                        "
                                                      >
                                                      </p-cascadeSelect>
                                                      <p>
                                                        <mat-error
                                                          *ngIf="(
                                            getSubCategoryThreeControls(i,j,k)?.at(l)?.dirty ||
                                            getSubCategoryThreeControls(i,j,k)?.at(l)?.touched
                                           ) &&
                                           getSubCategoryThreeControls(i,j,k)?.at(l)?.errors?.['getSubCategoryThreeError']"
                                                        >
                                                          Duplicate
                                                          subcategoryThree name
                                                          selected
                                                        </mat-error>
                                                      </p>
                                                      <div
                                                        *ngIf="
                                                          access.optionButton
                                                            .view
                                                        "
                                                      >
                                                        <button
                                                          class="bottun-align"
                                                          mat-icon-button
                                                          [matMenuTriggerFor]="
                                                            subCatThree
                                                          "
                                                          aria-label="Example icon-button with a menu"
                                                        >
                                                        <i class="pi pi-ellipsis-v"></i> &nbsp;
                                                        </button>
                                                        <mat-menu
                                                          #subCatThree="matMenu"
                                                        >
                                                          <!-- <button
                                                            *ngIf="
                                                              subCategoryThree
                                                                .value
                                                                .badgeCount <= 0
                                                            "
                                                            mat-menu-item
                                                            (click)="
                                                              openViewCommentOverlay(
                                                                $event,
                                                                subCategoryThree
                                                                  .value.nodeId,
                                                                'new'
                                                              )
                                                            "
                                                          >
                                                            <mat-icon
                                                              >bookmark</mat-icon
                                                            >
                                                            <span
                                                              >Raise the
                                                              issue</span
                                                            >
                                                          </button> -->
                                                          <button
                                                            mat-menu-item
                                                            (click)="
                                                              onSearchOption(
                                                                'subCategoryThree',
                                                                i,
                                                                j,
                                                                k,
                                                                l
                                                              )
                                                            "
                                                          >
                                                          <i class="pi pi-search"></i> &nbsp;
                                                            <span
                                                              >Search Tertiary
                                                              Sub-Category</span
                                                            >
                                                          </button>
                                                          <button
                                                            mat-menu-item
                                                            (click)="onAddCustom('Subcategory')"
                                                          >
                                                          <i class="pi pi-pencil"></i> &nbsp;
                                                            <span
                                                              >Add Custom
                                                              Tertiary
                                                              Sub-Category</span
                                                            >
                                                          </button>
                                                          <button
                                                            mat-menu-item
                                                            (click)="
                                                              addSubCategoryThree(
                                                                i,
                                                                j,
                                                                k
                                                              )
                                                            "
                                                          >
                                                          <i class="pi pi-plus-circle"></i> &nbsp;
                                                            <span
                                                              >Add new Tertiary
                                                              Sub-Category</span
                                                            >
                                                          </button>
                                                          <button
                                                            mat-menu-item
                                                            (click)="
                                                              initCombine(
                                                                i,
                                                                'subCategoryThree',
                                                                j,
                                                                k,
                                                                l
                                                              )
                                                            "
                                                          >
                                                          <i class="pi pi-sync"></i> &nbsp;
                                                            <span
                                                              >Combine Tertiary
                                                              Sub-Category</span
                                                            >
                                                          </button>
                                                          <button
                                                            [disabled]="
                                                              getSubCategoryThreeControls(
                                                                i,
                                                                j,
                                                                k
                                                              ).length == 1
                                                                ? true
                                                                : false
                                                            "
                                                            mat-menu-item
                                                            (click)="
                                                              removeSubCategoryThree(
                                                                i,
                                                                j,
                                                                k,
                                                                l
                                                              )
                                                            "
                                                          >
                                                          <i class="pi pi-minus-circle"></i> &nbsp;
                                                            <span
                                                              >Remove Tertiary
                                                              Sub-Category</span
                                                            >
                                                          </button>
                                                        </mat-menu>
                                                      </div>
                                                    </div>
                                                  </td>
                                                  <td>
                                                    <div>
                                                      <input
                                                        pInputText
                                                        type="number"
                                                        class="form-control"
                                                        formControlName="weightage"
                                                        min="0"
                                                        step="0.0001"
                                                        pattern="^[0-9]+(\.[0-9]{1,4})?$"
                                                        (keyup)="
                                                          validateWeightage(
                                                            i,
                                                            'subCategoryThree',
                                                            j,
                                                            k
                                                          )
                                                        "
                                                      />
                                                      <p>
                                                        <mat-error
                                                          *ngIf="(
                                              getSubCategoryThreeControls(i,j,k)?.at(l)?.dirty ||
                                              getSubCategoryThreeControls(i,j,k)?.at(l)?.touched
                                             ) &&
                                             getSubCategoryThreeControls(i,j,k)?.at(l)?.errors?.['weightageError']"
                                                        >
                                                          Weightage Addition
                                                          should not be greater
                                                          than 100
                                                        </mat-error>
                                                      </p>
                                                      <p>
                                                        <mat-error
                                                          *ngIf="(
                                              getSubCategoryThreeControls(i,j,k)?.at(l)?.dirty ||
                                              getSubCategoryThreeControls(i,j,k)?.at(l)?.touched
                                             ) &&
                                             getSubCategoryThreeControls(i,j,k)?.at(l)?.errors?.['negativeWeightageError']"
                                                        >
                                                          Only Positive decimal
                                                          numbers are allowed
                                                        </mat-error>
                                                      </p>
                                                    </div>
                                                  </td>
                                                  <!-- parameter Start-->
                                                  <div
                                                    formArrayName="parameter"
                                                  >
                                                    <table style="width: 100%">
                                                      <tr
                                                        *ngFor="
                                                          let parameter of getParameterControls(
                                                            i,
                                                            j,
                                                            k,
                                                            l
                                                          ).controls;
                                                          let m = index
                                                        "
                                                      >
                                                        <div
                                                          [formGroupName]="m"
                                                        >
                                                          <td>
                                                            <div
                                                              style="
                                                                position: relative;
                                                              "
                                                            >
                                                              <p-badge
                                                                *ngIf="
                                                                  parameter
                                                                    .value
                                                                    .badgeCount >
                                                                  0
                                                                "
                                                                [value]="
                                                                  parameter
                                                                    .value
                                                                    .badgeCount
                                                                "
                                                                class="comment-badge"
                                                                (click)="
                                                                  openViewCommentOverlay(
                                                                    $event,
                                                                    parameter
                                                                      .value
                                                                      .nodeId
                                                                  )
                                                                "
                                                                severity="warning"
                                                              ></p-badge>
                                                              <p-cascadeSelect
                                                                id="parametername"
                                                                [showClear]="
                                                                  true
                                                                "
                                                                (onClear)="
                                                                  onClearInput1()
                                                                "
                                                                formControlName="parametername"
                                                                [options]="
                                                                  categoriesData
                                                                "
                                                                (onChange)="
                                                                  onDropdownChange1(
                                                                    $event
                                                                  )
                                                                "
                                                                optionLabel="name"
                                                                optionValue="name"
                                                                optionGroupLabel="name"
                                                                [optionGroupChildren]="[
                                                                  'states',
                                                                  'cities'
                                                                ]"
                                                                [style]="{
                                                                  width:
                                                                    '13.7rem'
                                                                }"
                                                                placeholder="Select"
                                                                appendTo="body"
                                                                (onChange)="
                                                                  [
                                                                    onDropdownChange(
                                                                      $event
                                                                    )
                                                                  ]
                                                                "
                                                              >
                                                              </p-cascadeSelect>
                                                              <mat-error
                                                                *ngIf="(
                                                    getParameterControls(i,j,k,l)?.at(m)?.dirty ||
                                                    getParameterControls(i,j,k,l)?.at(m)?.touched
                                                 ) &&
                                                 getParameterControls(i,j,k,l)?.at(m)?.errors?.['parameterError']"
                                                              >
                                                                Duplicate
                                                                parameter name
                                                                selected</mat-error
                                                              >
                                                              <div
                                                                *ngIf="
                                                                  access
                                                                    .optionButton
                                                                    .view
                                                                "
                                                              >
                                                                <button
                                                                  class="bottun-align"
                                                                  mat-icon-button
                                                                  [matMenuTriggerFor]="
                                                                    para
                                                                  "
                                                                  aria-label="Example icon-button with a menu"
                                                                >
                                                                <i class="pi pi-ellipsis-v"></i> &nbsp;
                                                                </button>
                                                                <mat-menu
                                                                  #para="matMenu"
                                                                >
                                                                  <button
                                                                    mat-menu-item
                                                                    (click)="
                                                                      onSearchOption(
                                                                        'parameter',
                                                                        i,
                                                                        j,
                                                                        k,
                                                                        l,
                                                                        m
                                                                      )
                                                                    "
                                                                  >
                                                                  <i class="pi pi-search"></i> &nbsp;
                                                                    <span
                                                                      >Search
                                                                      Parameter</span
                                                                    >
                                                                  </button>
                                                                  <button
                                                                    mat-menu-item
                                                                    (click)="onAddCustom('parameter')"
                                                                  >
                                                                  <i class="pi pi-pencil"></i> &nbsp;
                                                                    <span
                                                                      >Add
                                                                      Custom
                                                                      Parameter</span
                                                                    >
                                                                  </button>
                                                                  <button
                                                                    mat-menu-item
                                                                    (click)="
                                                                      addParameter(
                                                                        i,
                                                                        j,
                                                                        k,
                                                                        l
                                                                      )
                                                                    "
                                                                  >
                                                                  <i class="pi pi-plus-circle"></i> &nbsp;
                                                                    <span
                                                                      >Add New
                                                                      Parameter</span
                                                                    >
                                                                  </button>
                                                                  <button
                                                                    mat-menu-item
                                                                    (click)="
                                                                      initCombine(
                                                                        i,
                                                                        'parameter',
                                                                        j,
                                                                        k,
                                                                        l,
                                                                        m
                                                                      )
                                                                    "
                                                                  >
                                                                  <i class="pi pi-sync"></i> &nbsp;
                                                                    <span
                                                                      >Move to
                                                                      Existing
                                                                      Subcategory</span
                                                                    >
                                                                  </button>
                                                                  <button
                                                                    [disabled]="
                                                                      getParameterControls(
                                                                        i,
                                                                        j,
                                                                        k,
                                                                        l
                                                                      )
                                                                        .length ==
                                                                      1
                                                                        ? true
                                                                        : false
                                                                    "
                                                                    mat-menu-item
                                                                    (click)="
                                                                      removeParameter(
                                                                        i,
                                                                        j,
                                                                        k,
                                                                        l,
                                                                        m
                                                                      )
                                                                    "
                                                                  >
                                                                  <i class="pi pi-minus-circle"></i> &nbsp;
                                                                    <span
                                                                      >Delete</span
                                                                    >
                                                                  </button>
                                                                </mat-menu>
                                                              </div>
                                                            </div>
                                                          </td>
                                                          <td>
                                                            <div>
                                                              <input
                                                                pInputText
                                                                type="number"
                                                                class="form-control"
                                                                formControlName="weightage"
                                                                min="0"
                                                                step="0.0001"
                                                                pattern="^[0-9]+(\.[0-9]{1,4})?$"
                                                                (keyup)="
                                                                  validateWeightage(
                                                                    i,
                                                                    'parameter',
                                                                    j,
                                                                    k,
                                                                    l
                                                                  )
                                                                "
                                                              />
                                                              <p>
                                                                <mat-error
                                                                  *ngIf="(
                                                      getParameterControls(i,j,k,l)?.at(m)?.dirty ||
                                                      getParameterControls(i,j,k,l)?.at(m)?.touched
                                                     ) &&
                                                     getParameterControls(i,j,k,l)?.at(m)?.errors?.['weightageError']"
                                                                >
                                                                  Weightage
                                                                  Addition
                                                                  should not be
                                                                  greater than
                                                                  100
                                                                </mat-error>
                                                              </p>
                                                              <p>
                                                                <mat-error
                                                                  *ngIf="(
                                                      getParameterControls(i,j,k,l)?.at(m)?.dirty ||
                                                      getParameterControls(i,j,k,l)?.at(m)?.touched
                                                     ) &&
                                                     getParameterControls(i,j,k,l)?.at(m)?.errors?.['negativeWeightageError']"
                                                                >
                                                                  Only Positive
                                                                  decimal
                                                                  numbers are
                                                                  allowed
                                                                </mat-error>
                                                              </p>
                                                            </div>
                                                          </td>
                                                          <td>
                                                            <div>
                                                              <input
                                                                pInputText
                                                                type="number"
                                                                class="form-control"
                                                                id="maxschore"
                                                                formControlName="maxschore"
                                                                min="0"
                                                                (keyup)="
                                                                  validateMaxScore(
                                                                    $event,
                                                                    i,
                                                                    j,
                                                                    k,
                                                                    l,
                                                                    m
                                                                  )
                                                                "
                                                              />
                                                              <p>
                                                                <mat-error
                                                                  *ngIf="(
                                                                  getParameterControls(i,j,k,l)?.at(m)?.dirty ||
                                                                  getParameterControls(i,j,k,l)?.at(m)?.touched||
                                                                  getParameterControls(i,j,k,l)?.at(m)?.valid
                                                                 ) &&
                                                                 getParameterControls(i,j,k,l)?.at(m)?.get('maxschore')?.errors?.['MaxscoreError']"
                                                                >
                                                                  Only Positive
                                                                  decimal
                                                                  numbers are
                                                                  allowed
                                                                </mat-error>
                                                              </p>

                                                              <p>
                                                                <mat-error
                                                                  *ngIf="(
                                                                  getParameterControls(i,j,k,l)?.at(m)?.dirty ||
                                                                  getParameterControls(i,j,k,l)?.at(m)?.touched||
                                                                  getParameterControls(i,j,k,l)?.at(m)?.valid
                                                                 ) &&
                                                                 getParameterControls(i,j,k,l)?.at(m)?.get('maxschore')?.errors?.['requiredMaxscoreError']"
                                                                >
                                                                  this field is
                                                                  required.
                                                                </mat-error>
                                                              </p>
                                                            </div>
                                                          </td>

                                                          <td>
                                                            <div
                                                              formArrayName="schoringcriteria"
                                                            >
                                                              <table
                                                                style="
                                                                  width: 100%;
                                                                "
                                                              >
                                                                <tr
                                                                  *ngFor="
                                                                    let scoringCriteria of getScoringCriteriaControls(
                                                                      i,
                                                                      j,
                                                                      k,
                                                                      l,
                                                                      m
                                                                    ).controls;
                                                                    let n = index
                                                                  "
                                                                >
                                                                  <div
                                                                    [formGroupName]="
                                                                      n
                                                                    "
                                                                  >
                                                                    <td>
                                                                      <div>
                                                                        <div
                                                                          style="
                                                                            position: relative;
                                                                            margin-left: 0%;
                                                                          "
                                                                        >
                                                                          <p-badge
                                                                            *ngIf="
                                                                              scoringCriteria
                                                                                .value
                                                                                .badgeCount >
                                                                              0
                                                                            "
                                                                            [value]="
                                                                              scoringCriteria
                                                                                .value
                                                                                .badgeCount
                                                                            "
                                                                            class="comment-badge"
                                                                            (click)="
                                                                              openViewCommentOverlay(
                                                                                $event,
                                                                                scoringCriteria
                                                                                  .value
                                                                                  .nodeId
                                                                              )
                                                                            "
                                                                            severity="warning"
                                                                          ></p-badge>
                                                                          <input
                                                                            pInputText
                                                                            type="text"
                                                                            class="form-control header"
                                                                            id="criteriaValue"
                                                                            formControlName="criteriaValue"
                                                                          />
                                                                          <div
                                                                            *ngIf="
                                                                              access
                                                                                .optionButton
                                                                                .view
                                                                            "
                                                                          >
                                                                            <button
                                                                              class="bottun-align"
                                                                              mat-icon-button
                                                                              [matMenuTriggerFor]="
                                                                                maxScore
                                                                              "
                                                                              aria-label="Example icon-button with a menu"
                                                                            >
                                                                            <i class="pi pi-ellipsis-v"></i> &nbsp;
                                                                            </button>
                                                                            <mat-menu
                                                                              #maxScore="matMenu"
                                                                            >
                                                                              <button
                                                                                mat-menu-item
                                                                                (click)="
                                                                                  addScoringCriteria(
                                                                                    i,
                                                                                    j,
                                                                                    k,
                                                                                    l,
                                                                                    m
                                                                                  )
                                                                                "
                                                                              >
                                                                              <i class="pi pi-plus-circle"></i> &nbsp;
                                                                                <span
                                                                                  >Add
                                                                                  Criteria</span
                                                                                >
                                                                              </button>
                                                                              <button
                                                                                [disabled]="
                                                                                  getScoringCriteriaControls(
                                                                                    i,
                                                                                    j,
                                                                                    k,
                                                                                    l,
                                                                                    m
                                                                                  )
                                                                                    .length ==
                                                                                  1
                                                                                    ? true
                                                                                    : false
                                                                                "
                                                                                mat-menu-item
                                                                                (click)="
                                                                                  removeScoringCriteria(
                                                                                    i,
                                                                                    j,
                                                                                    k,
                                                                                    l,
                                                                                    m,
                                                                                    n
                                                                                  )
                                                                                "
                                                                              >
                                                                              <i class="pi pi-minus-circle"></i> &nbsp;
                                                                                <span
                                                                                  >Delete</span
                                                                                >
                                                                              </button>
                                                                            </mat-menu>
                                                                          </div>
                                                                        </div>
                                                                      </div>
                                                                    </td>
                                                                  </div>
                                                                </tr>
                                                              </table>
                                                            </div>
                                                          </td>
                                                        </div>
                                                      </tr>
                                                    </table>
                                                  </div>
                                                  <!-- parameter End -->
                                                </div>
                                              </tr>
                                            </table>
                                          </div>
                                          <!-- End subcategoryThree -->
                                        </div>
                                      </tr>
                                    </table>
                                  </div>
                                  <!-- subcategoryTwo End -->
                                </div>
                              </tr>
                            </table>
                          </div>
                          <!-- subcategory End-->
                          <td>
                            <button
                              class="bottun-align"
                              mat-icon-button
                              [matMenuTriggerFor]="rMenu"
                              aria-label="Example icon-button with a menu"
                            >
                            <i class="pi pi-ellipsis-v"></i> &nbsp;
                            </button>

                            <mat-menu #rMenu="matMenu">
                              <button mat-menu-item (click)="addCategory()">
                                <i class="pi pi-plus-circle"></i> &nbsp;
                                <span>Add New Row</span>
                              </button>
                              <button
                                mat-menu-item
                                (click)="createCategoryCopy(i)"
                              >
                              <i class="pi pi-angle-double-down"></i> &nbsp;
                                <span>Copy Row</span>
                              </button>
                              <button
                                [disabled]="
                                  getCategoryControls().length == 1
                                    ? true
                                    : false
                                "
                                mat-menu-item
                                (click)="removeCategory(i)"
                              >
                              <i class="pi pi-minus-circle"></i> &nbsp;
                                <span>Remove Row</span>
                              </button>
                            </mat-menu>
                          </td>
                        </div>
                      </tr>
                    </table>
                  </div>
                </p-accordionTab>
              </p-accordion>
            </tr>
          </table>
          <!-- </p-accordionTab>
          </p-accordion> -->
        </tbody>
      </table>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-overlayPanel #viewCommentOverlay [style]="{ width: '350px' }">
      <ng-template pTemplate>
        <p-progressSpinner *ngIf="!viewComment"></p-progressSpinner>
        <div class="comment-overlay-panel" *ngIf="viewComment">
          <div class="comment-overlay-panel-header">
            <span>{{ commentData.comments.length }}</span> Comments
          </div>
          <div class="comment-overlay-panel-content">
            <div class="comment-header">
              <p-badge
                [value]="getUserCommentBadge(commentData.userId)"
                size="large"
                severity="success"
              ></p-badge>
              <span>{{ commentData.userId }}</span>
              <p>{{ commentData.issueText }}</p>
            </div>
            <ul class="comments">
              <li
                *ngFor="let comment of commentData.comments"
                [class]="getCommentClass(comment.userId)"
              >
                {{ comment.commentText }}
              </li>
            </ul>
          </div>
          <div class="comment-overlay-panel-footer" #commentInput>
            <form [formGroup]="commentForm">
              <span
                class="p-input-icon-right"
                style="display: block"
                *ngIf="
                  (commentData.caseStatus == 'Pending' &&
                    selectedTemplateData.status != 'Done') ||
                  issueType == 'new'
                "
              >
                <i
                  class="pi pi-send"
                  style="color: #d04a02; cursor: pointer"
                  (click)="postComment()"
                ></i>
                <input
                  type="text"
                  formControlName="comment"
                  pInputText
                  style="width: 100%"
                  placeholder="Type Reply here"
                  (keyup)="postComment($event, true)"
                />
              </span>
            </form>
          </div>
        </div>
      </ng-template>
    </p-overlayPanel>
    <div class="right-aligned">
      <button
        [disabled]="
          !isButtonEnabled ||
          !isButtonEnabled1 ||
          !isButtonEnabled2 ||
          !isButtonEnabled3 ||
          this.selectedTemplateData.status === 'Done'
        "
        pButton
        label="Save"
        icon="pi pi-check-circle"
        class="p-button-sm pbuttonclass67 standard-button"
        (click)="onClickSave()"
      ></button>
      <button
        pButton
        label="Cancel"
        icon="pi pi-times-circle"
        class="p-button-sm pbuttonclass standard-button"
        style="margin-right: 20px"
        (click)="onClickCancel()"
      ></button>
    </div>
    <div class="clearfix"></div>
  </ng-template>
</p-card>
<p-divider></p-divider>

<!-- to add custom line items -->
<div class="card">
  <p-dialog
    styleClass="customDialog"
    [visible]="addCustomDialog"
    (onHide)="onClickCancelCustomDialog()"
    dismissable="true"
    [modal]="true"
    [closable]="false"
  >
    <span>
      <label>Enter Value</label>
      <input
        pInputText
        [placeholder]="customType"
        [(ngModel)]="selectedCustomValue"
        class="customvalueInputBox"
      />
    </span>
    <br />
    <hr>
    <button
      pButton
      label="Add"
      class="customSubmitButton"
      (click)="onSubmit()"
    ></button>
    <button
      pButton
      label="Cancel"
      class="customCancelButton"
      (click)="onClickCancelCustomDialog()"
    ></button>
  </p-dialog>
</div>

<!-- Spinner -->
<ng-container *ngIf="isLoading">
  <div class="spinner"></div>
  <app-spinner></app-spinner>
</ng-container>

<!-- Notification msg's -->
<p-toast></p-toast>
<p-confirmDialog
  header="Confirmation"
  icon="pi pi-exclamation-triangle"
></p-confirmDialog>
